@model IEnumerable<Ugani_Restaurant.Models.MONAN>
@using Microsoft.AspNet.Identity
@{
    ViewBag.Title = "BookingFoods";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link rel="stylesheet" href="~/Content/StyleCSS/main.css" />
<link rel="stylesheet" href="~/Content/StyleCSS/numberic.css"/>
<div class="container">
    <div class="list-fooditem" >
        @foreach (var item in Model)
        {
            <div class="wrapper">
                <div class="food-item">
                    <div class="top" style="background-image: url('/Content/foodimages/@item.HINHANH'); background-repeat: no-repeat; background-position: center center;"></div>
                    <div class="bottom">
                        <div class="left">
                            <div class="details">
                                <div>
                                    <h5 class="itemName">@item.TENMONAN</h5>
                                    <p class="itemPrice">@item.DONGIA<span>@item.DVT</span></p>
                                </div>
                                <span class="input-wrapper">
                                    <button class="decrement">-</button>
                                    <input type="number" value="0" class="quantity" />
                                    <button class="increment">+</button>
                                </span>
                            </div>
                            <div class="buy" data-itemid="@item.MAMONAN" data-idkh=@User.Identity.GetUserId()>
                                <span class="material-symbols-outlined">shopping_cart</span>
                            </div>
                        </div>
                        <div class="right">
                            <div class="done"><span class="material-symbols-outlined">check</span></div>
                            <div class="details">

                            </div>
                            <div class="remove"><span class="material-symbols-outlined">close</span></div>
                        </div>
                    </div>
                </div>
            </div>
        }

    </div>
    <div>
        <button id="submit-button">Đặt món</button>
    </div>
</div>
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script>
    $(document).on('click', '.buy', function () {
        $(this).closest('.bottom').addClass("clicked");
    });

    $(document).on('click', '.remove', function () {
        $(this).closest('.bottom').removeClass("clicked");
    });

    var selectedItems = []; // Mảng lưu trữ thông tin chi tiết món ăn đã chọn

    $('.buy').click(function () {
        var idKH = $(this).data("idkh"); //lấy id Khách hàng 
        var itemID = $(this).data("itemid"); // Lấy ID món ăn từ dữ liệu HTML hoặc thuộc tính khác
        var itemName = $(this).siblings('.details').find('.itemName').text(); // Lấy tên món ăn
        var itemPrice = parseFloat($(this).siblings('.details').find('.itemPrice').text()); // Lấy giá món ăn
        var itemNumber = parseInt($(this).siblings('.details').find('.quantity').val()); //Lấy số lượng món muốn đặt
        var date = new Date();
        alert(idKH + itemID + itemName + itemPrice + itemNumber + date);

        // Tạo đối tượng chi tiết món ăn và thêm vào mảng selectedItems
        var itemDetail = {
            makh: idKH,
            id: itemID,
            number: itemNumber,
            date: date.toUTCString()
        };
        selectedItems.push(itemDetail);
    });

    $('#submit-button').click(function () {
        $.ajax({
            url: '/Home/SubmitBookingFoods', // Điền đúng đường dẫn của action trong controller của bạn
            method: 'POST',
            data: { selectedItems: selectedItems }, // Gửi dãy selectedItems lên máy chủ
            success: function (response) {
                // Xử lý kết quả trả về từ máy chủ (nếu cần)
            },
            error: function (error) {
                console.log(error);
            }
        });
    });

    // Lấy tất cả các trường nhập số và nút tăng/giảm
    const quantityInputs = document.querySelectorAll(".quantity");
    const incrementButtons = document.querySelectorAll(".increment");
    const decrementButtons = document.querySelectorAll(".decrement");

    // Hàm tăng giảm
    function handleIncrement(event) {
        const input = event.target.parentNode.querySelector(".quantity");
        input.value = parseInt(input.value) + 1;
    }

    function handleDecrement(event) {
        const input = event.target.parentNode.querySelector(".quantity");
        input.value = parseInt(input.value) - 1;
    }

    // Thêm sự kiện cho nút tăng và nút giảm
    incrementButtons.forEach(button => {
        button.addEventListener("click", handleIncrement);
    });

    decrementButtons.forEach(button => {
        button.addEventListener("click", handleDecrement);
    });




</script>






